\Qcircuit @C=1em @R=.7em @!R {
    & & \lstick{\ket{0}} & \gate{H} & \qw & \qw & \qw & \cdots & & \qw & \qw & \qw & \qw & \qw & \cdots & & \qw & \ctrl{12} & \qw & \multigate{4}{QFT} & \meter\\
    & & \lstick{\ket{0}} & \gate{H} & \qw & \qw & \qw & \cdots & & \qw & \qw & \qw & \qw & \qw & \cdots & & \ctrl{11} & \qw & \qw & \ghost{QFT} & \meter \\
    & & \lstick{\vdotswithin{\ket{0}}} & \vdotswithin{} & & & & \vdotswithin{} & & & & & & &  \vdotswithin{} & & \\
    & & \lstick{\ket{0}} & \gate{H} & \qw & \qw & \qw & \cdots & & \qw & \qw & \qw & \ctrl{9} & \qw & \cdots & & \qw & \qw & \qw & \ghost{QFT} & \meter\\
    & & \lstick{\ket{0}} & \gate{H} & \qw & \qw & \qw & \cdots & & \qw & \qw & \ctrl{8} & \qw & \qw & \cdots & & \qw & \qw & \qw & \ghost{QFT}& \meter \\
    & & & & & \\
    & & \lstick{\ket{0}} & \gate{H} & \qw & \qw & \qw & \cdots & & \qw & \ctrl{6} & \qw & \qw & \qw & \cdots & & \qw & \qw & \qw & \multigate{4}{QFT} & \meter \\
    & & \lstick{\ket{0}} & \gate{H} & \qw & \qw & \qw & \cdots & & \ctrl{5} & \qw & \qw & \qw & \qw & \cdots & & \qw & \qw & \qw & \ghost{QFT} & \meter \\
    & & \lstick{\vdotswithin{\ket{0}}} & \vdotswithin{} & & & & & & \\
    & & \lstick{\ket{0}} & \gate{H} & \qw & \ctrl{3} & \qw & \cdots & & \qw & \qw & \qw & \qw & \qw & \cdots & & \qw & \qw & \qw & \ghost{QFT} & \meter \\
    & & \lstick{\ket{0}} & \gate{H} & \ctrl{2} & \qw & \qw & \cdots & & \qw & \qw & \qw & \qw & \qw & \cdots & & \qw & \qw & \qw & \ghost{QFT} & \meter \\
    & & & & & \\
    & & \lstick{\ket{0}} & \qw & \gate{+D_p} & \gate{+[2]D_p} & \qw & \cdots & & \gate{+[2^{n-1}]D_p} & \gate{+[2^n]D_p} & \gate{+D_q} & \gate{+[2]D_q} & \qw & \cdots & & \gate{+[2^{n-1}]D_q} & \gate{[2^n]D_q} & \qw & \qw & \qw
    {\inputgroupv{1}{5}{1em}{4em}{R_1}} \\ {\inputgroupv{7}{11}{1em}{4em}{R_2}} \\
}